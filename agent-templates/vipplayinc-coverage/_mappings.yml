mappings:

  # coverage-mapping-agenda-control
  - type: mapping
    name: coverage-mapping-agenda-control
    title: "Coverage - Mapping Agenda Control"
    description: "Mapping data from agenda"
    outputs:
      agenda-control: |
        $.get('_document', {}).get('agenda-control', {}) if $.get('_document') else {}
      agenda-counter: |
        $.get('_document', {}).get('agenda-control', {}).get('counter', 0) if $.get('_document') else 0
      custom-instruction: |
        $.get('_document', {}).get('agenda-object', {}).get('custom_instruction', '') if $.get('_document') else ''
      custom-level: |
        $.get('_document', {}).get('agenda-object', {}).get('custom_level', '') if $.get('_document') else ''
      custom-script-name: |
        $.get('_document', {}).get('agenda-object', {}).get('custom_script_name', '') if $.get('_document') else ''
      custom-topic: |
        $.get('_document', {}).get('agenda-object', {}).get('custom_topic', '') if $.get('_document') else ''
      content-group: |
        $.get('_metadata', {}).get('content-group', '')
      content-name: |
        $.get('_metadata', {}).get('content-name', '')
      content-topic: |
        $.get('_metadata', {}).get('content-topic', '')
      event_code: |
        $.get('_metadata', {}).get('event_code', '')
      script-code: |
        $.get('_document', {}).get('agenda-object', {}).get('script_code', '') if $.get('_document') else ''
      script-instructions: |
        $.get('_document', {}).get('agenda-object', {}).get('content', '') if $.get('_document') else ''

  # coverage-mapping-agenda-script
  - type: mapping
    name: coverage-mapping-agenda-script
    title: "Coverage - Mapping Agenda Script"
    description: "Mapping data from agenda"
    outputs:
      content-group: "$.get('content-script-metadata', {}).get('content-group', '')"
      content-name: "$.get('content-script-metadata', {}).get('content-name', '')"
      event_code: "$.get('content-script-metadata', {}).get('event_code', '')"
      next-topic-to-cover: |
        'NONE_TOPIC_TO_COVER' if not $.get('topics-indexes', []) else (
          [
            script
            for script in $.get('topics-indexes', [])
            if script not in $.get('topics-covered', [])
          ][0] if [
            script
            for script in $.get('topics-indexes', [])
            if script not in $.get('topics-covered', [])
          ] else 'NONE_TOPIC_TO_COVER'
        )

  # coverage-mapping-agenda-script-object
  - type: mapping
    name: coverage-mapping-agenda-script-object
    title: "Coverage - Mapping Agenda Script Object"
    description: "Mapping data from agenda script"
    outputs:
      content-group: "$.get('content-script-metadata', {}).get('content-group', '')"
      content-name: "$.get('content-script-metadata', {}).get('content-name', '')"
      event_code: "$.get('content-script-metadata', {}).get('event_code', '')"
      next-topic-to-cover: |
        {'index': 'NONE_TOPIC_TO_COVER', 'description': ''} if not $.get('topics-indexes', []) else (
          [
            topic
            for topic in $.get('topics-indexes', [])
            if topic.get('index', '') not in $.get('topics-covered', [])
          ][0] if [
            topic
            for topic in $.get('topics-indexes', [])
            if topic.get('index', '') not in $.get('topics-covered', [])
          ] else {'index': 'NONE_TOPIC_TO_COVER', 'description': ''}
        )

  # coverage-mapping-date-prefix
  - type: mapping
    name: coverage-mapping-date-prefix
    title: "Coverage - Mapping Agenda Prefixes"
    description: "Mapping data from agenda service"
    outputs:
      date_prefix: f"{datetime.utcnow().strftime('%m%d')}-{datetime.utcnow().strftime('%A').upper()}"
